{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{auth,db}from\"../firebase\";import{collection,getDocs,updateDoc,deleteDoc,doc}from\"firebase/firestore\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function ManageUsers(){const[users,setUsers]=useState([]);const navigate=useNavigate();const currentUser=auth.currentUser;useEffect(()=>{if(!currentUser||currentUser.email!==\"dev@brightbots.in\"){navigate(\"/dashboard\");}else{fetchUsers();}},[currentUser,navigate]);const fetchUsers=async()=>{const snapshot=await getDocs(collection(db,\"users\"));const allUsers=snapshot.docs.map(docSnap=>({id:docSnap.id,...docSnap.data()}));const uniqueUsers=[];const seenEmails=new Map();// Deduplicate users and remove duplicates from Firestore\nfor(const user of allUsers){if(!seenEmails.has(user.email)){seenEmails.set(user.email,user.id);uniqueUsers.push(user);}else{// Delete duplicate from Firestore\nawait deleteDoc(doc(db,\"users\",user.id));console.log(`üóë Removed duplicate user: ${user.email}`);}}setUsers(uniqueUsers);};const makeAdmin=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;// safeguard\nawait updateDoc(doc(db,\"users\",userId),{role:\"admin\"});fetchUsers();};const removeAdmin=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;await updateDoc(doc(db,\"users\",userId),{role:\"user\"});fetchUsers();};const removeUser=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;// cannot delete super admin\nif(window.confirm(`Are you sure you want to remove ${email}?`)){await deleteDoc(doc(db,\"users\",userId));fetchUsers();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50 p-8 font-sans\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://brightbots.in/img/Brightbots-logo.png\",alt:\"Logo\",className:\"h-10\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-extrabold text-blue-800\",children:\"Manage Users\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/dashboard\"),className:\"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg\",children:\"\\u2190 Back to Dashboard\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow p-4\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"border-b font-semibold text-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Email Verified\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(user=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:user.email}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 font-medium text-gray-800\",children:user.email===\"dev@brightbots.in\"?\"Super Admin\":user.role===\"admin\"?\"Admin\":\"User\"}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:user.emailVerified?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-semibold\",children:\"\\u2705\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 font-semibold\",children:\"\\u274C\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 space-x-2\",children:user.email!==\"dev@brightbots.in\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[user.role!==\"admin\"?/*#__PURE__*/_jsx(\"button\",{onClick:()=>makeAdmin(user.id,user.email),className:\"bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Make Admin\"}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeAdmin(user.id,user.email),className:\"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Remove Admin\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeUser(user.id,user.email),className:\"bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Remove User\"})]})})]},user.id))})]})})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","auth","db","collection","getDocs","updateDoc","deleteDoc","doc","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ManageUsers","users","setUsers","navigate","currentUser","email","fetchUsers","snapshot","allUsers","docs","map","docSnap","id","data","uniqueUsers","seenEmails","Map","user","has","set","push","console","log","makeAdmin","userId","role","removeAdmin","removeUser","window","confirm","className","children","src","alt","onClick","emailVerified"],"sources":["C:/Users/mis/rbt-dashboard/src/pages/ManageUsers.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { auth, db } from \"../firebase\";\r\nimport {\r\n    collection,\r\n    getDocs,\r\n    updateDoc,\r\n    deleteDoc,\r\n    doc\r\n} from \"firebase/firestore\";\r\n\r\nexport default function ManageUsers() {\r\n    const [users, setUsers] = useState([]);\r\n    const navigate = useNavigate();\r\n    const currentUser = auth.currentUser;\r\n\r\n    useEffect(() => {\r\n        if (!currentUser || currentUser.email !== \"dev@brightbots.in\") {\r\n            navigate(\"/dashboard\");\r\n        } else {\r\n            fetchUsers();\r\n        }\r\n    }, [currentUser, navigate]);\r\n\r\n    const fetchUsers = async () => {\r\n        const snapshot = await getDocs(collection(db, \"users\"));\r\n        const allUsers = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));\r\n\r\n        const uniqueUsers = [];\r\n        const seenEmails = new Map();\r\n\r\n        // Deduplicate users and remove duplicates from Firestore\r\n        for (const user of allUsers) {\r\n            if (!seenEmails.has(user.email)) {\r\n                seenEmails.set(user.email, user.id);\r\n                uniqueUsers.push(user);\r\n            } else {\r\n                // Delete duplicate from Firestore\r\n                await deleteDoc(doc(db, \"users\", user.id));\r\n                console.log(`üóë Removed duplicate user: ${user.email}`);\r\n            }\r\n        }\r\n\r\n        setUsers(uniqueUsers);\r\n    };\r\n\r\n    const makeAdmin = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return; // safeguard\r\n        await updateDoc(doc(db, \"users\", userId), { role: \"admin\" });\r\n        fetchUsers();\r\n    };\r\n\r\n    const removeAdmin = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return;\r\n        await updateDoc(doc(db, \"users\", userId), { role: \"user\" });\r\n        fetchUsers();\r\n    };\r\n\r\n    const removeUser = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return; // cannot delete super admin\r\n        if (window.confirm(`Are you sure you want to remove ${email}?`)) {\r\n            await deleteDoc(doc(db, \"users\", userId));\r\n            fetchUsers();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 p-8 font-sans\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <img\r\n                        src=\"https://brightbots.in/img/Brightbots-logo.png\"\r\n                        alt=\"Logo\"\r\n                        className=\"h-10\"\r\n                    />\r\n                    <h1 className=\"text-2xl font-extrabold text-blue-800\">Manage Users</h1>\r\n                </div>\r\n                <button\r\n                    onClick={() => navigate(\"/dashboard\")}\r\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg\"\r\n                >\r\n                    ‚Üê Back to Dashboard\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow p-4\">\r\n                <table className=\"min-w-full text-sm text-left\">\r\n                    <thead className=\"border-b font-semibold text-gray-700\">\r\n                        <tr>\r\n                            <th className=\"px-4 py-2\">Email</th>\r\n                            <th className=\"px-4 py-2\">Status</th>\r\n                            <th className=\"px-4 py-2\">Email Verified</th>\r\n                            <th className=\"px-4 py-2\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {users.map(user => (\r\n                            <tr key={user.id} className=\"border-t hover:bg-gray-50\">\r\n                                <td className=\"px-4 py-2\">{user.email}</td>\r\n                                <td className=\"px-4 py-2 font-medium text-gray-800\">\r\n                                    {user.email === \"dev@brightbots.in\"\r\n                                        ? \"Super Admin\"\r\n                                        : user.role === \"admin\"\r\n                                            ? \"Admin\"\r\n                                            : \"User\"}\r\n                                </td>\r\n                                <td className=\"px-4 py-2\">\r\n                                    {user.emailVerified ? (\r\n                                        <span className=\"text-green-600 font-semibold\">‚úÖ</span>\r\n                                    ) : (\r\n                                        <span className=\"text-red-500 font-semibold\">‚ùå</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"px-4 py-2 space-x-2\">\r\n                                    {user.email !== \"dev@brightbots.in\" && (\r\n                                        <>\r\n                                            {user.role !== \"admin\" ? (\r\n                                                <button\r\n                                                    onClick={() => makeAdmin(user.id, user.email)}\r\n                                                    className=\"bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                                >\r\n                                                    Make Admin\r\n                                                </button>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={() => removeAdmin(user.id, user.email)}\r\n                                                    className=\"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                                >\r\n                                                    Remove Admin\r\n                                                </button>\r\n                                            )}\r\n\r\n                                            <button\r\n                                                onClick={() => removeUser(user.id, user.email)}\r\n                                                className=\"bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                            >\r\n                                                Remove User\r\n                                            </button>\r\n                                        </>\r\n                                    )}\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}