{"ast":null,"code":"import _objectSpread from\"C:/Users/mis/rbt-dashboard/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{auth,db}from\"../firebase\";import{useAuthState}from\"react-firebase-hooks/auth\";import{collection,getDocs,updateDoc,deleteDoc,doc}from\"firebase/firestore\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function ManageUsers(){const[users,setUsers]=useState([]);const navigate=useNavigate();const[user,loading]=useAuthState(auth);// reactive auth\nuseEffect(()=>{if(loading)return;// wait for auth to resolve\nif(!user){navigate(\"/login\",{replace:true});return;}if(user.email!==\"dev@brightbots.in\"){navigate(\"/dashboard\",{replace:true});return;}fetchUsers();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[user,loading]);const fetchUsers=async()=>{const snapshot=await getDocs(collection(db,\"users\"));const allUsers=snapshot.docs.map(docSnap=>_objectSpread({id:docSnap.id},docSnap.data()));const uniqueUsers=[];const seenEmails=new Map();// Deduplicate users and remove duplicates from Firestore\nfor(const u of allUsers){if(!seenEmails.has(u.email)){seenEmails.set(u.email,u.id);uniqueUsers.push(u);}else{await deleteDoc(doc(db,\"users\",u.id));console.log(\"\\uD83D\\uDDD1 Removed duplicate user: \".concat(u.email));}}setUsers(uniqueUsers);};const makeAdmin=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;// safeguard\nawait updateDoc(doc(db,\"users\",userId),{role:\"admin\"});fetchUsers();};const removeAdmin=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;await updateDoc(doc(db,\"users\",userId),{role:\"viewer\"});// align with the rest of the app\nfetchUsers();};const removeUser=async(userId,email)=>{if(email===\"dev@brightbots.in\")return;// cannot delete super admin\nif(window.confirm(\"Are you sure you want to remove \".concat(email,\"?\"))){await deleteDoc(doc(db,\"users\",userId));fetchUsers();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50 p-8 font-sans\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://brightbots.in/img/Brightbots-logo.png\",alt:\"Logo\",className:\"h-10\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-extrabold text-blue-800\",children:\"Manage Users\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/dashboard\"),className:\"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg\",children:\"\\u2190 Back to Dashboard\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow p-4\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"border-b font-semibold text-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Email Verified\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(u=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:u.email}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 font-medium text-gray-800\",children:u.email===\"dev@brightbots.in\"?\"Super Admin\":u.role===\"admin\"?\"Admin\":\"User\"}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:u.emailVerified?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-semibold\",children:\"\\u2705\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 font-semibold\",children:\"\\u274C\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 space-x-2\",children:u.email!==\"dev@brightbots.in\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[u.role!==\"admin\"?/*#__PURE__*/_jsx(\"button\",{onClick:()=>makeAdmin(u.id,u.email),className:\"bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Make Admin\"}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeAdmin(u.id,u.email),className:\"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Remove Admin\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeUser(u.id,u.email),className:\"bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded text-xs font-medium\",children:\"Remove User\"})]})})]},u.id))})]})})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","auth","db","useAuthState","collection","getDocs","updateDoc","deleteDoc","doc","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ManageUsers","users","setUsers","navigate","user","loading","replace","email","fetchUsers","snapshot","allUsers","docs","map","docSnap","_objectSpread","id","data","uniqueUsers","seenEmails","Map","u","has","set","push","console","log","concat","makeAdmin","userId","role","removeAdmin","removeUser","window","confirm","className","children","src","alt","onClick","emailVerified"],"sources":["C:/Users/mis/rbt-dashboard/src/pages/ManageUsers.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { auth, db } from \"../firebase\";\r\nimport { useAuthState } from \"react-firebase-hooks/auth\";\r\nimport {\r\n    collection,\r\n    getDocs,\r\n    updateDoc,\r\n    deleteDoc,\r\n    doc\r\n} from \"firebase/firestore\";\r\n\r\nexport default function ManageUsers() {\r\n    const [users, setUsers] = useState([]);\r\n    const navigate = useNavigate();\r\n    const [user, loading] = useAuthState(auth); // reactive auth\r\n\r\n    useEffect(() => {\r\n        if (loading) return; // wait for auth to resolve\r\n        if (!user) {\r\n            navigate(\"/login\", { replace: true });\r\n            return;\r\n        }\r\n        if (user.email !== \"dev@brightbots.in\") {\r\n            navigate(\"/dashboard\", { replace: true });\r\n            return;\r\n        }\r\n        fetchUsers();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [user, loading]);\r\n\r\n    const fetchUsers = async () => {\r\n        const snapshot = await getDocs(collection(db, \"users\"));\r\n        const allUsers = snapshot.docs.map((docSnap) => ({ id: docSnap.id, ...docSnap.data() }));\r\n\r\n        const uniqueUsers = [];\r\n        const seenEmails = new Map();\r\n\r\n        // Deduplicate users and remove duplicates from Firestore\r\n        for (const u of allUsers) {\r\n            if (!seenEmails.has(u.email)) {\r\n                seenEmails.set(u.email, u.id);\r\n                uniqueUsers.push(u);\r\n            } else {\r\n                await deleteDoc(doc(db, \"users\", u.id));\r\n                console.log(`üóë Removed duplicate user: ${u.email}`);\r\n            }\r\n        }\r\n\r\n        setUsers(uniqueUsers);\r\n    };\r\n\r\n    const makeAdmin = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return; // safeguard\r\n        await updateDoc(doc(db, \"users\", userId), { role: \"admin\" });\r\n        fetchUsers();\r\n    };\r\n\r\n    const removeAdmin = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return;\r\n        await updateDoc(doc(db, \"users\", userId), { role: \"viewer\" }); // align with the rest of the app\r\n        fetchUsers();\r\n    };\r\n\r\n    const removeUser = async (userId, email) => {\r\n        if (email === \"dev@brightbots.in\") return; // cannot delete super admin\r\n        if (window.confirm(`Are you sure you want to remove ${email}?`)) {\r\n            await deleteDoc(doc(db, \"users\", userId));\r\n            fetchUsers();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 p-8 font-sans\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <img\r\n                        src=\"https://brightbots.in/img/Brightbots-logo.png\"\r\n                        alt=\"Logo\"\r\n                        className=\"h-10\"\r\n                    />\r\n                    <h1 className=\"text-2xl font-extrabold text-blue-800\">Manage Users</h1>\r\n                </div>\r\n                <button\r\n                    onClick={() => navigate(\"/dashboard\")}\r\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg\"\r\n                >\r\n                    ‚Üê Back to Dashboard\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow p-4\">\r\n                <table className=\"min-w-full text-sm text-left\">\r\n                    <thead className=\"border-b font-semibold text-gray-700\">\r\n                        <tr>\r\n                            <th className=\"px-4 py-2\">Email</th>\r\n                            <th className=\"px-4 py-2\">Status</th>\r\n                            <th className=\"px-4 py-2\">Email Verified</th>\r\n                            <th className=\"px-4 py-2\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {users.map((u) => (\r\n                            <tr key={u.id} className=\"border-t hover:bg-gray-50\">\r\n                                <td className=\"px-4 py-2\">{u.email}</td>\r\n                                <td className=\"px-4 py-2 font-medium text-gray-800\">\r\n                                    {u.email === \"dev@brightbots.in\"\r\n                                        ? \"Super Admin\"\r\n                                        : u.role === \"admin\"\r\n                                            ? \"Admin\"\r\n                                            : \"User\"}\r\n                                </td>\r\n                                <td className=\"px-4 py-2\">\r\n                                    {u.emailVerified ? (\r\n                                        <span className=\"text-green-600 font-semibold\">‚úÖ</span>\r\n                                    ) : (\r\n                                        <span className=\"text-red-500 font-semibold\">‚ùå</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"px-4 py-2 space-x-2\">\r\n                                    {u.email !== \"dev@brightbots.in\" && (\r\n                                        <>\r\n                                            {u.role !== \"admin\" ? (\r\n                                                <button\r\n                                                    onClick={() => makeAdmin(u.id, u.email)}\r\n                                                    className=\"bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                                >\r\n                                                    Make Admin\r\n                                                </button>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={() => removeAdmin(u.id, u.email)}\r\n                                                    className=\"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                                >\r\n                                                    Remove Admin\r\n                                                </button>\r\n                                            )}\r\n\r\n                                            <button\r\n                                                onClick={() => removeUser(u.id, u.email)}\r\n                                                className=\"bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded text-xs font-medium\"\r\n                                            >\r\n                                                Remove User\r\n                                            </button>\r\n                                        </>\r\n                                    )}\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}